<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Generated by T-Systems -->
<hibernate-mapping>
    <class name="com.rsi.agp.dao.tables.poliza.Linea" table="TB_LINEAS">
        <comment>Lmneas</comment>
        <id name="lineaseguroid" type="java.lang.Long">
            <column name="LINEASEGUROID" precision="15" scale="0" />
            <generator class="sequence">
            	<param name="sequence">SQ_LINEASEGURO</param>
            </generator>
        </id>
        <property name="codlinea" type="java.math.BigDecimal">
            <column name="CODLINEA" precision="3" scale="0" not-null="true">
                <comment>Csdigo de la lmnea</comment>
            </column>
        </property>
        <property name="codplan" type="java.math.BigDecimal">
            <column name="CODPLAN" precision="4" scale="0" not-null="true">
                <comment>Nzmero de plan</comment>
            </column>
        </property>
        <property name="nomlinea" type="string">
            <column name="NOMLINEA" length="50" not-null="true">
                <comment>Nombre de la lmnea</comment>
            </column>
        </property>
        <property name="estado" type="string">
            <column name="ESTADO" length="10">
                <comment>Estado del plan/linea. Sus posibles valores son: 'Importado', 'Incompleto' y 'Error'</comment>
            </column>
        </property>
        <property name="activo" type="string">
            <column name="ACTIVO" length="2" not-null="true">
                <comment>Indica si el plan/lmnea esta activo para la contratacisn. Sus posibles valores son 'SI' y 'NO'</comment>
            </column>
        </property>
        <property name="fechaactivacion" type="java.util.Date">
            <column name="FECHAACTIVACION">
                <comment>Fecha en la que se activs el plan/lmnea</comment>
            </column>
        </property>
        <property name="maxpolizasppal" type="java.math.BigDecimal">
            <column name="MAXPOLIZASPPAL" precision="2" scale="0" />
        </property> 
        <!--<one-to-one name="importeFraccionamiento" class="com.rsi.agp.dao.tables.poliza.ImporteFraccionamiento"></one-to-one>-->
         <many-to-one name="diccionarioDatos" class="com.rsi.agp.dao.tables.org.DiccionarioDatos" fetch="select" lazy="no-proxy">
            <column name="CONCEPTOMAXPOLIZA" precision="3" scale="0" />
        </many-to-one>
        
       	<property name="esLineaGanadoCount" type="long"  formula="(select count(l.codlinea) from o02agpe0.tb_sc_c_lineas l where l.codlinea=codlinea and l.codgruposeguro='G01')"/>       	
       	
       	<property name="fechaInicioContratacion" type="java.util.Date" formula="
    (SELECT 
        CASE 
            WHEN (
                SELECT COUNT(l.codlinea) 
                FROM o02agpe0.tb_sc_c_lineas l 
                WHERE l.codlinea=codlinea 
                AND l.codgruposeguro='G01') > 0 
            THEN (
                SELECT MIN(g.FEC_CONTRAT_INI) 
                FROM O02AGPE0.TB_SC_C_FEC_CONTRAT_G g 
                WHERE g.LINEASEGUROID = LINEASEGUROID)
            ELSE (
                SELECT MIN(agr.FECINICIOCONTRATA) 
                FROM O02AGPE0.TB_SC_C_FEC_CONTRAT_AGR agr 
                WHERE agr.LINEASEGUROID = LINEASEGUROID)
        END
    FROM DUAL)"
/>
       	
       	
         <set name="lineaGrupoNegocios" table="TB_LINEAS_GRUPO_NEGOCIO" inverse="true" lazy="true" fetch="select">
            <key>
                <column name="LINEASEGUROID" precision="15" scale="0" not-null="true">
                    <comment>Identificador del plan/l&#237;nea</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.LineaGrupoNegocio" />
        </set>
    </class>
</hibernate-mapping>

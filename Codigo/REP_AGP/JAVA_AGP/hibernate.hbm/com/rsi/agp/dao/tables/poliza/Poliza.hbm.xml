<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Generated by T-Systems -->
<hibernate-mapping>
    <class name="com.rsi.agp.dao.tables.poliza.Poliza" table="TB_POLIZAS">
        <comment>Tabla principal de polizas.</comment>
        <id name="idpoliza" type="long">
            <column name="IDPOLIZA" precision="15" scale="0" />
            <generator class="sequence">
            	<param name="sequence">SQ_POLIZAS</param>
            </generator>
        </id> 
        <many-to-one name="usuario" class="com.rsi.agp.dao.tables.commons.Usuario" fetch="select" cascade="none" lazy="no-proxy">
            <column name="CODUSUARIO" length="8">
                <comment>Usuario propietario de la poliza</comment>
            </column>
        </many-to-one>
        <many-to-one name="estadoPoliza" class="com.rsi.agp.dao.tables.poliza.EstadoPoliza" fetch="select" lazy="no-proxy">
            <column name="IDESTADO" precision="15" scale="0" not-null="true">
                <comment>Identificador de estado</comment>
            </column>
        </many-to-one>
        <many-to-one name="polizaPpal" class="com.rsi.agp.dao.tables.poliza.Poliza" fetch="select" lazy="no-proxy">
            <column name="IDPOLIZA_PPAL" precision="15" scale="0">
                <comment>Identificador de la poliza principal. Solo para polizas complementarias</comment>
            </column>
        </many-to-one>
        <many-to-one name="colectivo" class="com.rsi.agp.dao.tables.admin.Colectivo" cascade="none" lazy="no-proxy">
            <column name="IDCOLECTIVO" precision="15" scale="0" not-null="true">
                <comment>Identificador del colectivo</comment>
            </column>
        </many-to-one>
        <many-to-one name="asegurado" class="com.rsi.agp.dao.tables.admin.Asegurado" fetch="select" cascade="none" lazy="no-proxy">
            <column name="IDASEGURADO" precision="15" scale="0" not-null="true">
                <comment>Identificador del asegurado</comment>
            </column>
        </many-to-one>
        <many-to-one name="linea" class="com.rsi.agp.dao.tables.poliza.Linea" fetch="select" lazy="no-proxy">
            <column name="LINEASEGUROID" precision="15" scale="0">
                <comment>Identificador del plan/l&#237;nea.</comment>
            </column>
        </many-to-one>
        <property name="discriminante" type="string">
            <column name="DISCRIMINANTE" length="3">
                <comment>Discriminante del asegurado</comment>
            </column>
        </property>
        <property name="oficina" type="string">
            <column name="OFICINA" length="4">
                <comment>Oficina a la que pertenece el usuario</comment>
            </column>
        </property>
        <property name="codmodulo" type="string">
            <column name="CODMODULO" length="5">
                <comment>Modulo</comment>
            </column>
        </property>
        <property name="referencia" type="string">
            <column name="REFERENCIA" length="7">
                <comment>Referencia agr&#237;cola</comment>
            </column>
        </property>
        <property name="importe" type="java.math.BigDecimal">
            <column name="IMPORTE" precision="11">
                <comment>Importe calculado para la poliza</comment>
            </column>
        </property>
        <property name="idenvio" type="java.math.BigDecimal">
            <column name="IDENVIO" precision="15" scale="0">
                <comment>Identificador del Envio</comment>
            </column>
        </property>
        <property name="dc" type="java.math.BigDecimal">
            <column name="DC" precision="1" scale="0">
                <comment>D&#237;gito de control</comment>
            </column>
        </property>
        <property name="xmlacusecontratacion" type="clob">
            <column name="XMLACUSECONTRATACION">
                <comment>Fichero xml de acuse de recibo de la contratacion de la poliza</comment>
            </column>
        </property>
        <property name="tipoReferencia" type="java.lang.Character">
            <column name="TIPOREF" length="1">
                <comment>Tipo de referencia</comment>
            </column>
        </property>     
        <property name="bloqueadopor" type="string">
            <column name="BLOQUEADAPOR" length="8">
                <comment>Usuario bloquea lo poliza</comment>
            </column>
        </property>
        <property name="fechabloqueo" type="date">
            <column name="FECHABLOQUEO" length="12">
                <comment>fecha bloqueo poliza</comment>
            </column>
        </property>
        <property name="fechaenvio" type="java.util.Date">
            <column name="FECHAENVIO">
                <comment>fecha envio poliza</comment>
            </column>
        </property>
         <property name="fechavigor" type="java.util.Date">
            <column name="FECHA_VIGOR">
                <comment>Fecha de entrada en vigor de la poliza</comment>
            </column>
        </property>
        <property name="clase" type="java.math.BigDecimal">
            <column name="CLASE" precision="3" scale="0">
                <comment>Clase</comment>
            </column>
        </property>        
        <property name="tienesiniestros" type="java.lang.Character">
            <column name="TIENESINIESTROS" length="1" not-null="true" />
        </property>
        <property name="tieneanexorc" type="java.lang.Character">
            <column name="TIENEANEXORC" length="1" not-null="true" />
        </property>
        <property name="tieneanexomp" type="java.lang.Character">
            <column name="TIENEANEXOMP" length="1" not-null="true" />
        </property>
        <property name="totalsuperficie" type="java.math.BigDecimal">
            <column name="TOTALSUPERFICIE" precision="15">
                <comment>Total de superficie de las parcelas de la poliza</comment>
            </column>
        </property>
         <property name="indRecalculoHojaNumero" type="long">
            <column name="IND_RECALCULO_HOJA_NUMERO" precision="1" scale="0">
                <comment>Indica si alguna parcela de la poliza se ha modificado y hay que recalcular la hoja y el numero (1 - Si, cualquier otro valor -
                No)</comment>
            </column>
        </property>
<!-- COMENTADO POR ASF EN LA SUBIDA DE LA PETICIÓN 17004 - PAGOS PARA NO TENER LAS CONSTANTES CON LOS ABREVIADOS EN EL CODIGO
     Y PODER UTILIZAR LA BASE DE DATOS PARA ESTO.
         <property name="idEstadoPago" type="long"               formula="(select php.idagp from VW_PAGO_HISTORICO_PLZ php WHERE php.IDPOLIZA = IDPOLIZA and rownum=1)"/> -->
<!--         <property name="idEstadoPago" type="java.lang.Long"> -->
<!--             <column name="PAGADA" precision="1" scale="0" not-null="true" /> -->
<!--         </property> -->
        <many-to-one name="estadoPagoAgp" class="com.rsi.agp.dao.tables.poliza.EstadoPagoAgp" fetch="select" cascade="none" lazy="no-proxy">
            <column name="PAGADA" precision="15" scale="0" not-null="true">
                <comment>Identificador del estado del pago</comment>
            </column>
        </many-to-one>
        
		<property name="fechaPago_descEstadoPago" type="string" lazy="true" formula="(select to_char(php.fecha, 'DD/MM/YYYY HH24:MI:SS') || '#' ||  PEP.DESCRIPCION from o02agpe0.VW_PAGO_HISTORICO_PLZ php, o02agpe0.TB_PAGO_ESTADOS_PAGO PEP WHERE PHP.IDPAGO = PEP.ID AND php.IDPOLIZA = IDPOLIZA and rownum=1)"/>
		
		<property name="fechaPago" type="java.util.Date">
            <column name="FECHA_PAGO">
                <comment>Fecha de pago de la poliza</comment>
            </column>
        </property>
		
        <property name="pacCargada" type="java.lang.Character">
            <column name="PAC_CARGADA" length="1" />
        </property>
        
        <property name="externa" type="integer">
        	<column name="EXTERNA" precision="1" scale="0" not-null="false">
        		<comment>Póliza importada de correduría externa 1.- SI 0.- NO</comment>
        	</column>
        </property>
        <property name="idCargaExplotaciones" type="java.lang.Integer">
            <column name="ID_CARGA_EXPLOTACIONES" precision="1" scale="0">
                <comment>Identificador del origen de datos de explotaciones seleccionado</comment>
            </column>
        </property>
        <set name="historicoEstados" table="TB_POLIZAS_HISTORICO_ESTADOS" inverse="true" lazy="true" fetch="select" order-by="FECHA desc">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>ID de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.HistoricoEstados" />
        </set> 
        
        <set name="subAseguradoCCAAs" table="TB_SUBVS_ASEG_CCAA" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.SubAseguradoCCAA" />
        </set>
        <set name="subAseguradoCCAAGanados" table="TB_SUBVS_ASEG_CCAA_G" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.SubAseguradoCCAAGanado" />
        </set>
        <set name="parcelaSWRendimientos" table="TB_PARCELA_SW_RENDIMIENTOS" inverse="true" lazy="true" fetch="select">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la p&#243;liza asociada</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.ParcelaSWRendimiento" />
        </set>
        <set name="explotacions" table="TB_EXPLOTACIONES" inverse="true" lazy="true" fetch="select">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la p&#243;liza asociada</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.explotaciones.Explotacion" />
        </set>
         <set name="moduloPolizas" table="TB_MODULOS_POLIZA" inverse="true" lazy="false" fetch="select" cascade="delete-orphan" >
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.ModuloPoliza" />
        </set>
        <set name="coberturaPolizas" table="TB_COBERTURAS_POLIZA" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.CoberturaPoliza" />
        </set>
        <set name="polizaComplementaria" table="TB_SBP_POLIZAS" inverse="true" lazy="true" fetch="select">
            <key>
                <column name="IDPOLIZACOM" precision="15" scale="0">
                    <comment>ID de la poliza complementaria</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.sbp.PolizaSbp" />
        </set> 
        <set name="polizaPrincipal" table="TB_SBP_POLIZAS" inverse="true" lazy="true" fetch="select">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>ID de la poliza principal</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.sbp.PolizaSbp" />
        </set>
        <set name="pagoPolizas" table="TB_PAGOS_POLIZA" inverse="true" lazy="false" fetch="select" cascade="all delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.PagoPoliza" />
        </set>
        <set name="anexoModificacions" table="TB_ANEXO_MOD" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0">
                    <comment>Identificador Poliza.</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.anexo.AnexoModificacion" />
        </set>
        <set name="anexoRCs" table="TB_ANEXO_RED" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0">
                    <comment>Identificador Poliza.</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.reduccionCap.ReduccionCapital" />
        </set>
        <set name="parcelas" table="TB_PARCELAS" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan" order-by="CODPROVINCIA asc, CODCOMARCA asc, CODTERMINO asc, SUBTERMINO asc, TIPOPARCELA desc">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.Parcela" />
        </set>
        <set name="polizas" table="TB_POLIZAS" inverse="true" lazy="true" fetch="select">
            <key>
                <column name="IDPOLIZA_PPAL" precision="15" scale="0">
                    <comment>Identificador de la poliza principal. Solo para polizas complementarias</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.Poliza" />
        </set>
        <set name="siniestros" table="TB_SINIESTROS" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" />
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.siniestro.Siniestro" />
        </set>
        <set name="subAseguradoENESAs" table="TB_SUBVS_ASEG_ENESA" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.SubAseguradoENESA" />
        </set>
        <set name="subAseguradoENESAGanados" table="TB_SUBVS_ASEG_ENESA_G" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.SubAseguradoENESAGanado" />
        </set>
        <set name="subvencionSocios" table="TB_SUBV_ENESA_SOCIOS" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan" order-by="nifsocio asc">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.SubvencionSocio" />
        </set>
        <set name="subvencionSocioGanados" table="TB_SUBV_ENESA_SOCIOS_GANADO" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan" order-by="nifsocio asc">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la p&#243;liza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.SubvencionSocioGanado" />
        </set>
        <set name="reduccionesCapital" table="TB_ANEXO_RED" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador Poliza.</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.reduccionCap.ReduccionCapital" />
        </set>
        <one-to-one name="datosAval" class="com.rsi.agp.dao.tables.poliza.DatosAval"></one-to-one>
        <set name="comparativaPolizas" table="TB_COMPARATIVAS_POLIZA" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.ComparativaPoliza" />
        </set>
        <set name="distribucionCoste2015s" table="TB_DISTRIBUCION_COSTES_2015" inverse="true" lazy="false" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la p&#243;liza asociada</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.dc2015.DistribucionCoste2015" />
        </set>
        <set name="polizaSocios" table="TB_POLIZA_SOCIOS" inverse="true" lazy="true" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.PolizaSocio" />
        </set>
        <set name="distribucionCostes" table="TB_DISTRIBUCION_COSTES" inverse="true" lazy="extra" fetch="select" cascade="delete-orphan">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.DistribucionCoste" />
        </set>
        <set name="setPolizaPctComisiones" table="TB_POLIZAS_PCT_COMISIONES" inverse="true" lazy="false" fetch="select">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la p&#243;liza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.PolizaPctComisiones" />
        </set>
        <set name="envioAgroseguros" table="TB_ENVIOS_AGROSEGURO" inverse="true" lazy="true" fetch="select" cascade="delete-orphan" order-by="fecha_envio desc">
            <key>
                <column name="IDPOLIZA" precision="15" scale="0" not-null="true">
                    <comment>Identificador de la poliza</comment>
                </column>
            </key>
            <one-to-many class="com.rsi.agp.dao.tables.poliza.EnvioAgroseguro" />
        </set>
       <property name="renovableSn" type="char" lazy="true" formula="(select decode(count(mp.idpoliza),0,'N','S') from o02agpe0.TB_MODULOS_POLIZA mp where mp.renovable = 1 and mp.idpoliza = IDPOLIZA)"/>
       
       <property name="esRyD" type="char" lazy="true" formula="(select decode(count(e.ID),0,'N','S') from o02agpe0.tb_explotaciones e
         																inner join o02agpe0.tb_grupo_raza_explotacion g on g.idexplotacion = e.id
         																where g.codtipocapital = 15 and e.idpoliza = IDPOLIZA)"/>
       
       <property name="esFinanciada" type="char" lazy="true" formula="(select decode(((select count(po.idpoliza)
																          from o02agpe0.tb_polizas po
																         inner join o02agpe0.TB_LINEAS L on po.LINEASEGUROID = L.LINEASEGUROID
																         inner join o02agpe0.TB_POLIZAS_RENOVABLES pr on pr.referencia = po.referencia and pr.plan = l.codplan
																         where pr.coste_total_tomador != pr.importe_domiciliar and po.IDPOLIZA = IDPOLIZA) 
																         +
																       (select count(dc.id)
																          from o02agpe0.tb_distribucion_costes_2015 dc
																         where (dc.importe_pago_fracc is not null or
																               dc.importe_pago_fracc_agr is not null)
																           and dc.idpoliza = IDPOLIZA)), 0, 'N', 'S')
																  	   from dual)"/>
																  	   
        <property name="fechaModificacion" type="java.util.Date">
        	<column name="FECHA_MODIFICACION">
            	<comment>Fecha en la que se da de alta o modifica el registro</comment>
        	</column>
   		</property>
   		
        <!-- 3/01/2019 DNF -->
        <many-to-one name="estadoAgroseguro" class="com.rsi.agp.dao.tables.poliza.EstadoAgroseguro" fetch="select">
            <column name="IDESTADO_AGRO" precision="3" scale="0">
                <comment>Estado de la p&#243;liza en Agroseguro</comment>
            </column>
        </many-to-one>
        <property name="fechaSeguimiento" type="java.util.Date">
            <column name="FECHA_SEGUIMIENTO" length="7">
                <comment>Fecha en la que se modifica el estado Agroseguro</comment>
            </column>
        </property>
        <property name="costeTomadorAgro" type="java.math.BigDecimal">
            <column name="COSTE_TOMADOR_AGRO" precision="11">
                <comment>Coste tomador de la p&#243;liza en Agroseguro</comment>
            </column>
        </property>
        
        <property name="notaPrevia" type="integer">
        	<column name="NOTA_PREVIA" precision="1" scale="0" not-null="false">
        		<comment>Check de nota previa enviada 1.- SI 0.- NO</comment>
        	</column>
        </property>
        <property name="IPID" type="integer">
        	<column name="IPID" precision="1" scale="0" not-null="false">
        		<comment>Check de IPID enviado 1.- SI 0.- NO</comment>
        	</column>
        </property>
        <property name="RGPD" type="integer">
        	<column name="RGPD" precision="1" scale="0" not-null="false">
        		<comment>Check de RGPD enviado 1.- SI 0.- NO</comment>
        	</column>
        </property>
        <!-- GDLD-67752 ** MODIF TAM (25.08.2021) -->
        <!-- Por esta petición solo se ha añadido el campo de Fecha de Vencimiento, pero faltan campos incluidos anteriormente que no están en el hbm y que se incluyen -->
        <property name="fechaVencimiento" type="java.util.Date">
            <column name="FECHA_VTO" length="7">
                <comment>Fecha de Vencimiento de la póliza</comment>
            </column>
        </property>
        <!-- P73325 - RQ.04, RQ.05 y RQ.06  -->
        <one-to-one name="gedDocPoliza" class="com.rsi.agp.dao.tables.ged.GedDocPoliza" cascade="delete" lazy="false" fetch="join"/>   
    </class>
</hibernate-mapping>
